<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.IP.Op</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Bits</span><span>
</span><a name="line-4"></a><span class="hs-keyword">import</span><span> </span><a href="Data.IP.Addr.html"><span class="hs-identifier">Data.IP.Addr</span></a><span>
</span><a name="line-5"></a><span class="hs-keyword">import</span><span> </span><a href="Data.IP.Mask.html"><span class="hs-identifier">Data.IP.Mask</span></a><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span> </span><a href="Data.IP.Range.html"><span class="hs-identifier">Data.IP.Range</span></a><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-comment">{-|

&gt;&gt;&gt; toIPv4 [127,0,2,1] `masked` intToMask 7
126.0.0.0
-}</span><span>
</span><a name="line-15"></a><span class="hs-keyword">class</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679063802"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="Addr"><a href="Data.IP.Op.html#Addr"><span class="hs-identifier">Addr</span></a></a><span> </span><a name="local-6989586621679063802"><a href="#local-6989586621679063802"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-16"></a><span>    </span><span class="hs-comment">{-|
      The 'masked' function takes an 'Addr' and a contiguous
      mask and returned a masked 'Addr'.
    -}</span><span>
</span><a name="line-20"></a><span>    </span><a name="masked"><a href="Data.IP.Op.html#masked"><span class="hs-identifier">masked</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679063802"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679063802"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679063802"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-21"></a><span>    </span><span class="hs-comment">{-|

      The 'intToMask' function takes an 'Int' representing the number of bits to
      be set in the returned contiguous mask. When this integer is positive the
      bits will be starting from the MSB and from the LSB otherwise.

      &gt;&gt;&gt; intToMask 16 :: IPv4
      255.255.0.0

      &gt;&gt;&gt; intToMask (-16) :: IPv4
      0.0.255.255

      &gt;&gt;&gt; intToMask 16 :: IPv6
      ffff::

      &gt;&gt;&gt; intToMask (-16) :: IPv6
      ::ffff

    -}</span><span>
</span><a name="line-40"></a><span>    </span><a name="intToMask"><a href="Data.IP.Op.html#intToMask"><span class="hs-identifier">intToMask</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679063802"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.IP.Op.html#Addr"><span class="hs-identifier hs-type">Addr</span></a><span> </span><a href="Data.IP.Addr.html#IPv4"><span class="hs-identifier hs-type">IPv4</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-43"></a><span>    </span><a name="local-8214565720323838706"><a href="Data.IP.Op.html#masked"><span class="hs-identifier">masked</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.Range.html#maskedIPv4"><span class="hs-identifier hs-var">maskedIPv4</span></a><span>
</span><a name="line-44"></a><span>    </span><a name="local-8214565720323838707"><a href="Data.IP.Op.html#intToMask"><span class="hs-identifier">intToMask</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.Mask.html#maskIPv4"><span class="hs-identifier hs-var">maskIPv4</span></a><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.IP.Op.html#Addr"><span class="hs-identifier hs-type">Addr</span></a><span> </span><a href="Data.IP.Addr.html#IPv6"><span class="hs-identifier hs-type">IPv6</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-47"></a><span>    </span><a name="local-8214565720323838706"><a href="Data.IP.Op.html#masked"><span class="hs-identifier">masked</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.Range.html#maskedIPv6"><span class="hs-identifier hs-var">maskedIPv6</span></a><span>
</span><a name="line-48"></a><span>    </span><a name="local-8214565720323838707"><a href="Data.IP.Op.html#intToMask"><span class="hs-identifier">intToMask</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.Mask.html#maskIPv6"><span class="hs-identifier hs-var">maskIPv6</span></a><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-comment">{-|
  The &gt;:&gt; operator takes two 'AddrRange'. It returns 'True' if
  the first 'AddrRange' contains the second 'AddrRange'. Otherwise,
  it returns 'False'.

&gt;&gt;&gt; makeAddrRange (&quot;127.0.2.1&quot; :: IPv4) 8 &gt;:&gt; makeAddrRange &quot;127.0.2.1&quot; 24
True
&gt;&gt;&gt; makeAddrRange (&quot;127.0.2.1&quot; :: IPv4) 24 &gt;:&gt; makeAddrRange &quot;127.0.2.1&quot; 8
False
&gt;&gt;&gt; makeAddrRange (&quot;2001:DB8::1&quot; :: IPv6) 16 &gt;:&gt; makeAddrRange &quot;2001:DB8::1&quot; 32
True
&gt;&gt;&gt; makeAddrRange (&quot;2001:DB8::1&quot; :: IPv6) 32 &gt;:&gt; makeAddrRange &quot;2001:DB8::1&quot; 16
False
-}</span><span>
</span><a name="line-66"></a><span class="hs-special">(</span><span class="hs-operator">&gt;:&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.Op.html#Addr"><span class="hs-identifier hs-type">Addr</span></a><span> </span><a href="#local-6989586621679063806"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679063806"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679063806"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-67"></a><a name="local-6989586621679063807"><a href="#local-6989586621679063807"><span class="hs-identifier">a</span></a></a><span> </span><a name="%3E%3A%3E"><a href="Data.IP.Op.html#%3E%3A%3E"><span class="hs-operator">&gt;:&gt;</span></a></a><span> </span><a name="local-6989586621679063808"><a href="#local-6989586621679063808"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mlen</span><span> </span><a href="#local-6989586621679063807"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-identifier">mlen</span><span> </span><a href="#local-6989586621679063808"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">addr</span><span> </span><a href="#local-6989586621679063808"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">`</span><a href="Data.IP.Op.html#masked"><span class="hs-identifier hs-var">masked</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">mask</span><span> </span><a href="#local-6989586621679063807"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">addr</span><span> </span><a href="#local-6989586621679063807"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">{-|
  The 'toMatchedTo' function take an 'Addr' address and an 'AddrRange',
  and returns 'True' if the range contains the address.

&gt;&gt;&gt; (&quot;127.0.2.0&quot; :: IPv4) `isMatchedTo` makeAddrRange &quot;127.0.2.1&quot; 24
True
&gt;&gt;&gt; (&quot;127.0.2.0&quot; :: IPv4) `isMatchedTo` makeAddrRange &quot;127.0.2.1&quot; 32
False
&gt;&gt;&gt; (&quot;2001:DB8::1&quot; :: IPv6) `isMatchedTo` makeAddrRange &quot;2001:DB8::1&quot; 32
True
&gt;&gt;&gt; (&quot;2001:DB8::&quot; :: IPv6) `isMatchedTo` makeAddrRange &quot;2001:DB8::1&quot; 128
False
-}</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-identifier">isMatchedTo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.Op.html#Addr"><span class="hs-identifier hs-type">Addr</span></a><span> </span><a href="#local-6989586621679063805"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679063805"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679063805"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-84"></a><a name="isMatchedTo"><a href="Data.IP.Op.html#isMatchedTo"><span class="hs-identifier">isMatchedTo</span></a></a><span> </span><a name="local-6989586621679063809"><a href="#local-6989586621679063809"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679063810"><a href="#local-6989586621679063810"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679063809"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="Data.IP.Op.html#masked"><span class="hs-identifier hs-var">masked</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">mask</span><span> </span><a href="#local-6989586621679063810"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">addr</span><span> </span><a href="#local-6989586621679063810"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-comment">{-|
  The 'makeAddrRange' functions takes an 'Addr' address and a mask
  length. It creates a bit mask from the mask length and masks
  the 'Addr' address, then returns 'AddrRange' made of them.

&gt;&gt;&gt; makeAddrRange (toIPv4 [127,0,2,1]) 8
127.0.0.0/8
&gt;&gt;&gt; makeAddrRange (toIPv6 [0x2001,0xDB8,0,0,0,0,0,1]) 8
2000::/8
-}</span><span>
</span><a name="line-96"></a><span class="hs-identifier">makeAddrRange</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.Op.html#Addr"><span class="hs-identifier hs-type">Addr</span></a><span> </span><a href="#local-6989586621679063804"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679063804"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679063804"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-97"></a><a name="makeAddrRange"><a href="Data.IP.Op.html#makeAddrRange"><span class="hs-identifier">makeAddrRange</span></a></a><span> </span><a name="local-6989586621679063811"><a href="#local-6989586621679063811"><span class="hs-identifier">ad</span></a></a><span> </span><a name="local-6989586621679063812"><a href="#local-6989586621679063812"><span class="hs-identifier">len</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-var">AddrRange</span></a><span> </span><a href="#local-6989586621679063814"><span class="hs-identifier hs-var">adr</span></a><span> </span><a href="#local-6989586621679063813"><span class="hs-identifier hs-var">msk</span></a><span> </span><a href="#local-6989586621679063812"><span class="hs-identifier hs-var">len</span></a><span>
</span><a name="line-98"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-99"></a><span>    </span><a name="local-6989586621679063813"><a href="#local-6989586621679063813"><span class="hs-identifier">msk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.Op.html#intToMask"><span class="hs-identifier hs-var">intToMask</span></a><span> </span><a href="#local-6989586621679063812"><span class="hs-identifier hs-var">len</span></a><span>
</span><a name="line-100"></a><span>    </span><a name="local-6989586621679063814"><a href="#local-6989586621679063814"><span class="hs-identifier">adr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679063811"><span class="hs-identifier hs-var">ad</span></a><span> </span><span class="hs-special">`</span><a href="Data.IP.Op.html#masked"><span class="hs-identifier hs-var">masked</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679063813"><span class="hs-identifier hs-var">msk</span></a><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-comment">-- | Convert IPv4 range to IPV4-embedded-in-IPV6 range</span><span>
</span><a name="line-104"></a><span class="hs-identifier">ipv4RangeToIPv6</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="Data.IP.Addr.html#IPv4"><span class="hs-identifier hs-type">IPv4</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="Data.IP.Addr.html#IPv6"><span class="hs-identifier hs-type">IPv6</span></a><span>
</span><a name="line-105"></a><a name="ipv4RangeToIPv6"><a href="Data.IP.Op.html#ipv4RangeToIPv6"><span class="hs-identifier">ipv4RangeToIPv6</span></a></a><span> </span><a name="local-6989586621679063815"><a href="#local-6989586621679063815"><span class="hs-identifier">range</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-106"></a><span>  </span><a href="Data.IP.Op.html#makeAddrRange"><span class="hs-identifier hs-var">makeAddrRange</span></a><span> </span><span class="hs-special">(</span><a href="Data.IP.Addr.html#toIPv6"><span class="hs-identifier hs-var">toIPv6</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">0xffff</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679063818"><span class="hs-identifier hs-var">i1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shift</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="#local-6989586621679063819"><span class="hs-identifier hs-var">i2</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679063820"><span class="hs-identifier hs-var">i3</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shift</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="#local-6989586621679063821"><span class="hs-identifier hs-var">i4</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679063817"><span class="hs-identifier hs-var">masklen</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">96</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679063816"><a href="#local-6989586621679063816"><span class="hs-identifier">ip</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679063817"><a href="#local-6989586621679063817"><span class="hs-identifier">masklen</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.Op.html#addrRangePair"><span class="hs-identifier hs-var">addrRangePair</span></a><span> </span><a href="#local-6989586621679063815"><span class="hs-identifier hs-var">range</span></a><span>
</span><a name="line-109"></a><span>    </span><span class="hs-special">[</span><a name="local-6989586621679063818"><a href="#local-6989586621679063818"><span class="hs-identifier">i1</span></a></a><span class="hs-special">,</span><a name="local-6989586621679063819"><a href="#local-6989586621679063819"><span class="hs-identifier">i2</span></a></a><span class="hs-special">,</span><a name="local-6989586621679063820"><a href="#local-6989586621679063820"><span class="hs-identifier">i3</span></a></a><span class="hs-special">,</span><a name="local-6989586621679063821"><a href="#local-6989586621679063821"><span class="hs-identifier">i4</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.IP.Addr.html#fromIPv4"><span class="hs-identifier hs-var">fromIPv4</span></a><span> </span><a href="#local-6989586621679063816"><span class="hs-identifier hs-var">ip</span></a><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-comment">{-|
  The 'unmakeAddrRange' functions take a 'AddrRange' and
  returns the network address and a mask length.

&gt;&gt;&gt; addrRangePair (&quot;127.0.0.0/8&quot; :: AddrRange IPv4)
(127.0.0.0,8)
&gt;&gt;&gt; addrRangePair (&quot;2000::/8&quot; :: AddrRange IPv6)
(2000::,8)
-}</span><span>
</span><a name="line-121"></a><span class="hs-identifier">addrRangePair</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.IP.Op.html#Addr"><span class="hs-identifier hs-type">Addr</span></a><span> </span><a href="#local-6989586621679063803"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-type">AddrRange</span></a><span> </span><a href="#local-6989586621679063803"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679063803"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-122"></a><a name="addrRangePair"><a href="Data.IP.Op.html#addrRangePair"><span class="hs-identifier">addrRangePair</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.IP.Range.html#AddrRange"><span class="hs-identifier hs-var">AddrRange</span></a><span> </span><a name="local-6989586621679063822"><a href="#local-6989586621679063822"><span class="hs-identifier">adr</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679063823"><a href="#local-6989586621679063823"><span class="hs-identifier">len</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679063822"><span class="hs-identifier hs-var">adr</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679063823"><span class="hs-identifier hs-var">len</span></a><span class="hs-special">)</span><span>
</span><a name="line-123"></a></pre></body></html>