<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|

This module defines a generic web application interface. It is a common
protocol between web servers and web applications.

The overriding design principles here are performance and generality. To
address performance, this library uses a streaming interface for request and
response bodies, paired with bytestring's 'Builder' type.  The advantages of a
streaming API over lazy IO have been debated elsewhere and so will not be
addressed here.  However, helper functions like 'responseLBS' allow you to
continue using lazy IO if you so desire.

Generality is achieved by removing many variables commonly found in similar
projects that are not universal to all servers. The goal is that the 'Request'
object contains only data which is meaningful in all circumstances.

Please remember when using this package that, while your application may
compile without a hitch against many different servers, there are other
considerations to be taken when moving to a new backend. For example, if you
transfer from a CGI application to a FastCGI one, you might suddenly find you
have a memory leak. Conversely, a FastCGI application would be well served to
preload all templates from disk when first starting; this would kill the
performance of a CGI application.

This package purposely provides very little functionality. You can find various
middlewares, backends and utilities on Hackage. Some of the most commonly used
include:

[warp] &lt;http://hackage.haskell.org/package/warp&gt;

[wai-extra] &lt;http://hackage.haskell.org/package/wai-extra&gt;

[wai-test] &lt;http://hackage.haskell.org/package/wai-test&gt;

-}</span><span>
</span><a name="line-36"></a><span class="hs-comment">-- Ignore deprecations, because this module needs to use the deprecated requestBody to construct a response.</span><span>
</span><a name="line-37"></a><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-deprecations #-}</span><span>
</span><a name="line-38"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network.Wai</span><span>
</span><a name="line-39"></a><span>    </span><span class="hs-special">(</span><span>
</span><a name="line-40"></a><span>      </span><span class="hs-comment">-- * Types</span><span>
</span><a name="line-41"></a><span>      </span><a href="Network.Wai.html#Application"><span class="hs-identifier hs-type">Application</span></a><span>
</span><a name="line-42"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#Middleware"><span class="hs-identifier hs-type">Middleware</span></a><span>
</span><a name="line-43"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#ResponseReceived"><span class="hs-identifier hs-type">ResponseReceived</span></a><span>
</span><a name="line-44"></a><span>      </span><span class="hs-comment">-- * Request</span><span>
</span><a name="line-45"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#Request"><span class="hs-identifier hs-type">Request</span></a><span>
</span><a name="line-46"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#defaultRequest"><span class="hs-identifier hs-var">defaultRequest</span></a><span>
</span><a name="line-47"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#RequestBodyLength"><span class="hs-identifier hs-type">RequestBodyLength</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span>      </span><span class="hs-comment">-- ** Request accessors</span><span>
</span><a name="line-49"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#requestMethod"><span class="hs-identifier hs-var">requestMethod</span></a><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#httpVersion"><span class="hs-identifier hs-var">httpVersion</span></a><span>
</span><a name="line-51"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#rawPathInfo"><span class="hs-identifier hs-var">rawPathInfo</span></a><span>
</span><a name="line-52"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#rawQueryString"><span class="hs-identifier hs-var">rawQueryString</span></a><span>
</span><a name="line-53"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#requestHeaders"><span class="hs-identifier hs-var">requestHeaders</span></a><span>
</span><a name="line-54"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#isSecure"><span class="hs-identifier hs-var">isSecure</span></a><span>
</span><a name="line-55"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#remoteHost"><span class="hs-identifier hs-var">remoteHost</span></a><span>
</span><a name="line-56"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#pathInfo"><span class="hs-identifier hs-var">pathInfo</span></a><span>
</span><a name="line-57"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#queryString"><span class="hs-identifier hs-var">queryString</span></a><span>
</span><a name="line-58"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#requestBody"><span class="hs-identifier hs-var">requestBody</span></a><span>
</span><a name="line-59"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#vault"><span class="hs-identifier hs-var">vault</span></a><span>
</span><a name="line-60"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#requestBodyLength"><span class="hs-identifier hs-var">requestBodyLength</span></a><span>
</span><a name="line-61"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#requestHeaderHost"><span class="hs-identifier hs-var">requestHeaderHost</span></a><span>
</span><a name="line-62"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#requestHeaderRange"><span class="hs-identifier hs-var">requestHeaderRange</span></a><span>
</span><a name="line-63"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#requestHeaderReferer"><span class="hs-identifier hs-var">requestHeaderReferer</span></a><span>
</span><a name="line-64"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#requestHeaderUserAgent"><span class="hs-identifier hs-var">requestHeaderUserAgent</span></a><span>
</span><a name="line-65"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#strictRequestBody"><span class="hs-identifier hs-var">strictRequestBody</span></a><span>
</span><a name="line-66"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#lazyRequestBody"><span class="hs-identifier hs-var">lazyRequestBody</span></a><span>
</span><a name="line-67"></a><span>      </span><span class="hs-comment">-- * Response</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span>
</span><a name="line-69"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#StreamingBody"><span class="hs-identifier hs-type">StreamingBody</span></a><span>
</span><a name="line-70"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.Internal.html#FilePart"><span class="hs-identifier hs-type">FilePart</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span>      </span><span class="hs-comment">-- ** Response composers</span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#responseFile"><span class="hs-identifier hs-var">responseFile</span></a><span>
</span><a name="line-73"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#responseBuilder"><span class="hs-identifier hs-var">responseBuilder</span></a><span>
</span><a name="line-74"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#responseLBS"><span class="hs-identifier hs-var">responseLBS</span></a><span>
</span><a name="line-75"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#responseStream"><span class="hs-identifier hs-var">responseStream</span></a><span>
</span><a name="line-76"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#responseRaw"><span class="hs-identifier hs-var">responseRaw</span></a><span>
</span><a name="line-77"></a><span>      </span><span class="hs-comment">-- ** Response accessors</span><span>
</span><a name="line-78"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#responseStatus"><span class="hs-identifier hs-var">responseStatus</span></a><span>
</span><a name="line-79"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#responseHeaders"><span class="hs-identifier hs-var">responseHeaders</span></a><span>
</span><a name="line-80"></a><span>      </span><span class="hs-comment">-- ** Response modifiers</span><span>
</span><a name="line-81"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#responseToStream"><span class="hs-identifier hs-var">responseToStream</span></a><span>
</span><a name="line-82"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#mapResponseHeaders"><span class="hs-identifier hs-var">mapResponseHeaders</span></a><span>
</span><a name="line-83"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#mapResponseStatus"><span class="hs-identifier hs-var">mapResponseStatus</span></a><span>
</span><a name="line-84"></a><span>      </span><span class="hs-comment">-- * Middleware composition</span><span>
</span><a name="line-85"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#ifRequest"><span class="hs-identifier hs-var">ifRequest</span></a><span>
</span><a name="line-86"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Network.Wai.html#modifyResponse"><span class="hs-identifier hs-var">modifyResponse</span></a><span>
</span><a name="line-87"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.ByteString.Builder</span><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Builder</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">lazyByteString</span><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.ByteString.Builder</span><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">byteString</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad</span><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unless</span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString</span><span>              </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Lazy</span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Lazy.Internal</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LI</span><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.ByteString.Lazy.Internal</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">defaultChunkSize</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.ByteString.Lazy.Char8</span><span>   </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Function</span><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fix</span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Network.HTTP.Types</span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">H</span><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Network.Socket</span><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SockAddr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SockAddrInet</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span>           </span><a href="Network.Wai.Internal.html"><span class="hs-identifier">Network.Wai.Internal</span></a><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">System.IO</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IO</span><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">System.IO.Unsafe</span><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unsafeInterleaveIO</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-comment">-- | Creating 'Response' from a file.</span><span>
</span><a name="line-107"></a><span class="hs-identifier">responseFile</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">H.Status</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">H.ResponseHeaders</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Network.Wai.Internal.html#FilePart"><span class="hs-identifier hs-type">FilePart</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span>
</span><a name="line-108"></a><a name="responseFile"><a href="Network.Wai.html#responseFile"><span class="hs-identifier">responseFile</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#ResponseFile"><span class="hs-identifier hs-var">ResponseFile</span></a><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-comment">-- | Creating 'Response' from 'Builder'.</span><span>
</span><a name="line-111"></a><span class="hs-comment">--</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- Some questions and answers about the usage of 'Builder' here:</span><span>
</span><a name="line-113"></a><span class="hs-comment">--</span><span>
</span><a name="line-114"></a><span class="hs-comment">-- Q1. Shouldn't it be at the user's discretion to use Builders internally and</span><span>
</span><a name="line-115"></a><span class="hs-comment">-- then create a stream of ByteStrings?</span><span>
</span><a name="line-116"></a><span class="hs-comment">--</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- A1. That would be less efficient, as we wouldn't get cheap concatenation</span><span>
</span><a name="line-118"></a><span class="hs-comment">-- with the response headers.</span><span>
</span><a name="line-119"></a><span class="hs-comment">--</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- Q2. Isn't it really inefficient to convert from ByteString to Builder, and</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- then right back to ByteString?</span><span>
</span><a name="line-122"></a><span class="hs-comment">--</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- A2. No. If the ByteStrings are small, then they will be copied into a larger</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- buffer, which should be a performance gain overall (less system calls). If</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- they are already large, then an insert operation is used</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- to avoid copying.</span><span>
</span><a name="line-127"></a><span class="hs-comment">--</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- Q3. Doesn't this prevent us from creating comet-style servers, since data</span><span>
</span><a name="line-129"></a><span class="hs-comment">-- will be cached?</span><span>
</span><a name="line-130"></a><span class="hs-comment">--</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- A3. You can force a Builder to output a ByteString before it is an</span><span>
</span><a name="line-132"></a><span class="hs-comment">-- optimal size by sending a flush command.</span><span>
</span><a name="line-133"></a><span class="hs-identifier">responseBuilder</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">H.Status</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">H.ResponseHeaders</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Builder</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span>
</span><a name="line-134"></a><a name="responseBuilder"><a href="Network.Wai.html#responseBuilder"><span class="hs-identifier">responseBuilder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#ResponseBuilder"><span class="hs-identifier hs-var">ResponseBuilder</span></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-comment">-- | Creating 'Response' from 'L.ByteString'. This is a wrapper for</span><span>
</span><a name="line-137"></a><span class="hs-comment">--   'responseBuilder'.</span><span>
</span><a name="line-138"></a><span class="hs-identifier">responseLBS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">H.Status</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">H.ResponseHeaders</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span>
</span><a name="line-139"></a><a name="responseLBS"><a href="Network.Wai.html#responseLBS"><span class="hs-identifier">responseLBS</span></a></a><span> </span><a name="local-6989586621679041008"><a href="#local-6989586621679041008"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679041009"><a href="#local-6989586621679041009"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#ResponseBuilder"><span class="hs-identifier hs-var">ResponseBuilder</span></a><span> </span><a href="#local-6989586621679041008"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679041009"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">lazyByteString</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-comment">-- | Creating 'Response' from a stream of values.</span><span>
</span><a name="line-142"></a><span class="hs-comment">--</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- In order to allocate resources in an exception-safe manner, you can use the</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- @bracket@ pattern outside of the call to @responseStream@. As a trivial</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- example:</span><span>
</span><a name="line-146"></a><span class="hs-comment">--</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- app :: Application</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- app req respond = bracket_</span><span>
</span><a name="line-150"></a><span class="hs-comment">--     (putStrLn \&quot;Allocating scarce resource\&quot;)</span><span>
</span><a name="line-151"></a><span class="hs-comment">--     (putStrLn \&quot;Cleaning up\&quot;)</span><span>
</span><a name="line-152"></a><span class="hs-comment">--     $ respond $ responseStream status200 [] $ \\write flush -&gt; do</span><span>
</span><a name="line-153"></a><span class="hs-comment">--         write $ byteString \&quot;Hello\\n\&quot;</span><span>
</span><a name="line-154"></a><span class="hs-comment">--         flush</span><span>
</span><a name="line-155"></a><span class="hs-comment">--         write $ byteString \&quot;World\\n\&quot;</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-157"></a><span class="hs-comment">--</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- Note that in some cases you can use @bracket@ from inside @responseStream@</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- as well. However, placing the call on the outside allows your status value</span><span>
</span><a name="line-160"></a><span class="hs-comment">-- and response headers to depend on the scarce resource.</span><span>
</span><a name="line-161"></a><span class="hs-comment">--</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- Since 3.0.0</span><span>
</span><a name="line-163"></a><span class="hs-identifier">responseStream</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">H.Status</span><span>
</span><a name="line-164"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">H.ResponseHeaders</span><span>
</span><a name="line-165"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.Internal.html#StreamingBody"><span class="hs-identifier hs-type">StreamingBody</span></a><span>
</span><a name="line-166"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span>
</span><a name="line-167"></a><a name="responseStream"><a href="Network.Wai.html#responseStream"><span class="hs-identifier">responseStream</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#ResponseStream"><span class="hs-identifier hs-var">ResponseStream</span></a><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span class="hs-comment">-- | Create a response for a raw application. This is useful for \&quot;upgrade\&quot;</span><span>
</span><a name="line-170"></a><span class="hs-comment">-- situations such as WebSockets, where an application requests for the server</span><span>
</span><a name="line-171"></a><span class="hs-comment">-- to grant it raw network access.</span><span>
</span><a name="line-172"></a><span class="hs-comment">--</span><span>
</span><a name="line-173"></a><span class="hs-comment">-- This function requires a backup response to be provided, for the case where</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- the handler in question does not support such upgrading (e.g., CGI apps).</span><span>
</span><a name="line-175"></a><span class="hs-comment">--</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- In the event that you read from the request body before returning a</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- @responseRaw@, behavior is undefined.</span><span>
</span><a name="line-178"></a><span class="hs-comment">--</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- Since 2.1.0</span><span>
</span><a name="line-180"></a><span class="hs-identifier">responseRaw</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">B.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">B.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span>
</span><a name="line-182"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span>
</span><a name="line-183"></a><a name="responseRaw"><a href="Network.Wai.html#responseRaw"><span class="hs-identifier">responseRaw</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#ResponseRaw"><span class="hs-identifier hs-var">ResponseRaw</span></a><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-comment">-- | Accessing 'H.Status' in 'Response'.</span><span>
</span><a name="line-188"></a><span class="hs-identifier">responseStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">H.Status</span><span>
</span><a name="line-189"></a><a name="responseStatus"><a href="Network.Wai.html#responseStatus"><span class="hs-identifier">responseStatus</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseFile"><span class="hs-identifier hs-var">ResponseFile</span></a><span>    </span><a name="local-6989586621679041010"><a href="#local-6989586621679041010"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041010"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-190"></a><span class="hs-identifier">responseStatus</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseBuilder"><span class="hs-identifier hs-var">ResponseBuilder</span></a><span> </span><a name="local-6989586621679041011"><a href="#local-6989586621679041011"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041011"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-191"></a><span class="hs-identifier">responseStatus</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseStream"><span class="hs-identifier hs-var">ResponseStream</span></a><span>  </span><a name="local-6989586621679041012"><a href="#local-6989586621679041012"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041012"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-192"></a><span class="hs-identifier">responseStatus</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseRaw"><span class="hs-identifier hs-var">ResponseRaw</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679041013"><a href="#local-6989586621679041013"><span class="hs-identifier">res</span></a></a><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.html#responseStatus"><span class="hs-identifier hs-var">responseStatus</span></a><span> </span><a href="#local-6989586621679041013"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-comment">-- | Accessing 'H.ResponseHeaders' in 'Response'.</span><span>
</span><a name="line-195"></a><span class="hs-identifier">responseHeaders</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">H.ResponseHeaders</span><span>
</span><a name="line-196"></a><a name="responseHeaders"><a href="Network.Wai.html#responseHeaders"><span class="hs-identifier">responseHeaders</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseFile"><span class="hs-identifier hs-var">ResponseFile</span></a><span>    </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679041014"><a href="#local-6989586621679041014"><span class="hs-identifier">hs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041014"><span class="hs-identifier hs-var">hs</span></a><span>
</span><a name="line-197"></a><span class="hs-identifier">responseHeaders</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseBuilder"><span class="hs-identifier hs-var">ResponseBuilder</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679041015"><a href="#local-6989586621679041015"><span class="hs-identifier">hs</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041015"><span class="hs-identifier hs-var">hs</span></a><span>
</span><a name="line-198"></a><span class="hs-identifier">responseHeaders</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseStream"><span class="hs-identifier hs-var">ResponseStream</span></a><span>  </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679041016"><a href="#local-6989586621679041016"><span class="hs-identifier">hs</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041016"><span class="hs-identifier hs-var">hs</span></a><span>
</span><a name="line-199"></a><span class="hs-identifier">responseHeaders</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseRaw"><span class="hs-identifier hs-var">ResponseRaw</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679041017"><a href="#local-6989586621679041017"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.html#responseHeaders"><span class="hs-identifier hs-var">responseHeaders</span></a><span> </span><a href="#local-6989586621679041017"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span class="hs-comment">-- | Converting the body information in 'Response' to a 'StreamingBody'.</span><span>
</span><a name="line-202"></a><span class="hs-identifier">responseToStream</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span>
</span><a name="line-203"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">H.Status</span><span>
</span><a name="line-204"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">H.ResponseHeaders</span><span>
</span><a name="line-205"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#StreamingBody"><span class="hs-identifier hs-type">StreamingBody</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679041007"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679041007"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-206"></a><span>                    </span><span class="hs-special">)</span><span>
</span><a name="line-207"></a><a name="responseToStream"><a href="Network.Wai.html#responseToStream"><span class="hs-identifier">responseToStream</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseStream"><span class="hs-identifier hs-var">ResponseStream</span></a><span> </span><a name="local-6989586621679041018"><a href="#local-6989586621679041018"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679041019"><a href="#local-6989586621679041019"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679041020"><a href="#local-6989586621679041020"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041018"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679041019"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679041020"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span class="hs-identifier">responseToStream</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseFile"><span class="hs-identifier hs-var">ResponseFile</span></a><span> </span><a name="local-6989586621679041021"><a href="#local-6989586621679041021"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679041022"><a href="#local-6989586621679041022"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679041023"><a href="#local-6989586621679041023"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679041024"><a href="#local-6989586621679041024"><span class="hs-identifier">part</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-209"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621679041021"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-210"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679041022"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-211"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041025"><a href="#local-6989586621679041025"><span class="hs-identifier">withBody</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">IO.withBinaryFile</span><span> </span><a href="#local-6989586621679041023"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-identifier hs-var">IO.ReadMode</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041026"><a href="#local-6989586621679041026"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679041025"><span class="hs-identifier hs-var">withBody</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041027"><a href="#local-6989586621679041027"><span class="hs-identifier">sendChunk</span></a></a><span> </span><a name="local-6989586621679041028"><a href="#local-6989586621679041028"><span class="hs-identifier">_flush</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-212"></a><span>        </span><span class="hs-identifier hs-var">IO.hSeek</span><span> </span><a href="#local-6989586621679041026"><span class="hs-identifier hs-var">handle</span></a><span> </span><span class="hs-identifier hs-var">IO.AbsoluteSeek</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">filePartOffset</span><span> </span><a href="#local-6989586621679041024"><span class="hs-identifier hs-var">part</span></a><span>
</span><a name="line-213"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679041029"><a href="#local-6989586621679041029"><span class="hs-identifier">loop</span></a></a><span> </span><a name="local-6989586621679041030"><a href="#local-6989586621679041030"><span class="hs-identifier">remaining</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679041030"><span class="hs-identifier hs-var">remaining</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>            </span><span class="hs-identifier">loop</span><span> </span><a name="local-6989586621679041031"><a href="#local-6989586621679041031"><span class="hs-identifier">remaining</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-215"></a><span>                </span><a name="local-6989586621679041032"><a href="#local-6989586621679041032"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">B.hGetSome</span><span> </span><a href="#local-6989586621679041026"><span class="hs-identifier hs-var">handle</span></a><span> </span><span class="hs-identifier hs-var">defaultChunkSize</span><span>
</span><a name="line-216"></a><span>                </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B.null</span><span> </span><a href="#local-6989586621679041032"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-217"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679041033"><a href="#local-6989586621679041033"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B.take</span><span> </span><a href="#local-6989586621679041031"><span class="hs-identifier hs-var">remaining</span></a><span> </span><a href="#local-6989586621679041032"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-218"></a><span>                    </span><a href="#local-6989586621679041027"><span class="hs-identifier hs-var">sendChunk</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">byteString</span><span> </span><a href="#local-6989586621679041033"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-219"></a><span>                    </span><a href="#local-6989586621679041029"><span class="hs-identifier hs-var">loop</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679041031"><span class="hs-identifier hs-var">remaining</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">B.length</span><span> </span><a href="#local-6989586621679041033"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-220"></a><span>        </span><a href="#local-6989586621679041029"><span class="hs-identifier hs-var">loop</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">filePartByteCount</span><span> </span><a href="#local-6989586621679041024"><span class="hs-identifier hs-var">part</span></a><span>
</span><a name="line-221"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span class="hs-identifier">responseToStream</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseFile"><span class="hs-identifier hs-var">ResponseFile</span></a><span> </span><a name="local-6989586621679041114"><a href="#local-6989586621679041114"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679041115"><a href="#local-6989586621679041115"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679041116"><a href="#local-6989586621679041116"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-223"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621679041114"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-224"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679041115"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-225"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041117"><a href="#local-6989586621679041117"><span class="hs-identifier">withBody</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">IO.withBinaryFile</span><span> </span><a href="#local-6989586621679041116"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-identifier hs-var">IO.ReadMode</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041118"><a href="#local-6989586621679041118"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-226"></a><span>       </span><a href="#local-6989586621679041117"><span class="hs-identifier hs-var">withBody</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041119"><a href="#local-6989586621679041119"><span class="hs-identifier">sendChunk</span></a></a><span> </span><a name="local-6989586621679041120"><a href="#local-6989586621679041120"><span class="hs-identifier">_flush</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fix</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041121"><a href="#local-6989586621679041121"><span class="hs-identifier">loop</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-227"></a><span>            </span><a name="local-6989586621679041122"><a href="#local-6989586621679041122"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">B.hGetSome</span><span> </span><a href="#local-6989586621679041118"><span class="hs-identifier hs-var">handle</span></a><span> </span><span class="hs-identifier hs-var">defaultChunkSize</span><span>
</span><a name="line-228"></a><span>            </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">B.null</span><span> </span><a href="#local-6989586621679041122"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-229"></a><span>                </span><a href="#local-6989586621679041119"><span class="hs-identifier hs-var">sendChunk</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">byteString</span><span> </span><a href="#local-6989586621679041122"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-230"></a><span>                </span><a href="#local-6989586621679041121"><span class="hs-identifier hs-var">loop</span></a><span>
</span><a name="line-231"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span class="hs-identifier">responseToStream</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseBuilder"><span class="hs-identifier hs-var">ResponseBuilder</span></a><span> </span><a name="local-6989586621679041123"><a href="#local-6989586621679041123"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679041124"><a href="#local-6989586621679041124"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679041125"><a href="#local-6989586621679041125"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-233"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621679041123"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679041124"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041126"><a href="#local-6989586621679041126"><span class="hs-identifier">withBody</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679041126"><span class="hs-identifier hs-var">withBody</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041127"><a href="#local-6989586621679041127"><span class="hs-identifier">sendChunk</span></a></a><span> </span><a name="local-6989586621679041128"><a href="#local-6989586621679041128"><span class="hs-identifier">_flush</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679041127"><span class="hs-identifier hs-var">sendChunk</span></a><span> </span><a href="#local-6989586621679041125"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span class="hs-identifier">responseToStream</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseRaw"><span class="hs-identifier hs-var">ResponseRaw</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679041129"><a href="#local-6989586621679041129"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.html#responseToStream"><span class="hs-identifier hs-var">responseToStream</span></a><span> </span><a href="#local-6989586621679041129"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-comment">-- | Apply the provided function to the response header list of the Response.</span><span>
</span><a name="line-237"></a><span class="hs-identifier">mapResponseHeaders</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">H.ResponseHeaders</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">H.ResponseHeaders</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span>
</span><a name="line-238"></a><a name="mapResponseHeaders"><a href="Network.Wai.html#mapResponseHeaders"><span class="hs-identifier">mapResponseHeaders</span></a></a><span> </span><a name="local-6989586621679041130"><a href="#local-6989586621679041130"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseFile"><span class="hs-identifier hs-var">ResponseFile</span></a><span> </span><a name="local-6989586621679041131"><a href="#local-6989586621679041131"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679041132"><a href="#local-6989586621679041132"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679041133"><a href="#local-6989586621679041133"><span class="hs-identifier">b1</span></a></a><span> </span><a name="local-6989586621679041134"><a href="#local-6989586621679041134"><span class="hs-identifier">b2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#ResponseFile"><span class="hs-identifier hs-var">ResponseFile</span></a><span> </span><a href="#local-6989586621679041131"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041130"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679041132"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679041133"><span class="hs-identifier hs-var">b1</span></a><span> </span><a href="#local-6989586621679041134"><span class="hs-identifier hs-var">b2</span></a><span>
</span><a name="line-239"></a><span class="hs-identifier">mapResponseHeaders</span><span> </span><a name="local-6989586621679041135"><a href="#local-6989586621679041135"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseBuilder"><span class="hs-identifier hs-var">ResponseBuilder</span></a><span> </span><a name="local-6989586621679041136"><a href="#local-6989586621679041136"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679041137"><a href="#local-6989586621679041137"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679041138"><a href="#local-6989586621679041138"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#ResponseBuilder"><span class="hs-identifier hs-var">ResponseBuilder</span></a><span> </span><a href="#local-6989586621679041136"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041135"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679041137"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679041138"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-240"></a><span class="hs-identifier">mapResponseHeaders</span><span> </span><a name="local-6989586621679041139"><a href="#local-6989586621679041139"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseStream"><span class="hs-identifier hs-var">ResponseStream</span></a><span> </span><a name="local-6989586621679041140"><a href="#local-6989586621679041140"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679041141"><a href="#local-6989586621679041141"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679041142"><a href="#local-6989586621679041142"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#ResponseStream"><span class="hs-identifier hs-var">ResponseStream</span></a><span> </span><a href="#local-6989586621679041140"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041139"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679041141"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679041142"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-241"></a><span class="hs-identifier">mapResponseHeaders</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679041143"><a href="#local-6989586621679041143"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseRaw"><span class="hs-identifier hs-var">ResponseRaw</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041143"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span class="hs-comment">-- | Apply the provided function to the response status of the Response.</span><span>
</span><a name="line-244"></a><span class="hs-identifier">mapResponseStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">H.Status</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">H.Status</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span>
</span><a name="line-245"></a><a name="mapResponseStatus"><a href="Network.Wai.html#mapResponseStatus"><span class="hs-identifier">mapResponseStatus</span></a></a><span> </span><a name="local-6989586621679041144"><a href="#local-6989586621679041144"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseFile"><span class="hs-identifier hs-var">ResponseFile</span></a><span> </span><a name="local-6989586621679041145"><a href="#local-6989586621679041145"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679041146"><a href="#local-6989586621679041146"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679041147"><a href="#local-6989586621679041147"><span class="hs-identifier">b1</span></a></a><span> </span><a name="local-6989586621679041148"><a href="#local-6989586621679041148"><span class="hs-identifier">b2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#ResponseFile"><span class="hs-identifier hs-var">ResponseFile</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041144"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679041145"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679041146"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679041147"><span class="hs-identifier hs-var">b1</span></a><span> </span><a href="#local-6989586621679041148"><span class="hs-identifier hs-var">b2</span></a><span>
</span><a name="line-246"></a><span class="hs-identifier">mapResponseStatus</span><span> </span><a name="local-6989586621679041149"><a href="#local-6989586621679041149"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseBuilder"><span class="hs-identifier hs-var">ResponseBuilder</span></a><span> </span><a name="local-6989586621679041150"><a href="#local-6989586621679041150"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679041151"><a href="#local-6989586621679041151"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679041152"><a href="#local-6989586621679041152"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#ResponseBuilder"><span class="hs-identifier hs-var">ResponseBuilder</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041149"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679041150"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679041151"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679041152"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-247"></a><span class="hs-identifier">mapResponseStatus</span><span> </span><a name="local-6989586621679041153"><a href="#local-6989586621679041153"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseStream"><span class="hs-identifier hs-var">ResponseStream</span></a><span> </span><a name="local-6989586621679041154"><a href="#local-6989586621679041154"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679041155"><a href="#local-6989586621679041155"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679041156"><a href="#local-6989586621679041156"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#ResponseStream"><span class="hs-identifier hs-var">ResponseStream</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041153"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679041154"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679041155"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679041156"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-248"></a><span class="hs-identifier">mapResponseStatus</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679041157"><a href="#local-6989586621679041157"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#ResponseRaw"><span class="hs-identifier hs-var">ResponseRaw</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041157"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span class="hs-comment">----------------------------------------------------------------</span><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-comment">-- | The WAI application.</span><span>
</span><a name="line-253"></a><span class="hs-comment">--</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- Note that, since WAI 3.0, this type is structured in continuation passing</span><span>
</span><a name="line-255"></a><span class="hs-comment">-- style to allow for proper safe resource handling. This was handled in the</span><span>
</span><a name="line-256"></a><span class="hs-comment">-- past via other means (e.g., @ResourceT@). As a demonstration:</span><span>
</span><a name="line-257"></a><span class="hs-comment">--</span><span>
</span><a name="line-258"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-259"></a><span class="hs-comment">-- app :: Application</span><span>
</span><a name="line-260"></a><span class="hs-comment">-- app req respond = bracket_</span><span>
</span><a name="line-261"></a><span class="hs-comment">--     (putStrLn \&quot;Allocating scarce resource\&quot;)</span><span>
</span><a name="line-262"></a><span class="hs-comment">--     (putStrLn \&quot;Cleaning up\&quot;)</span><span>
</span><a name="line-263"></a><span class="hs-comment">--     (respond $ responseLBS status200 [] \&quot;Hello World\&quot;)</span><span>
</span><a name="line-264"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-265"></a><span class="hs-keyword">type</span><span> </span><a name="Application"><a href="Network.Wai.html#Application"><span class="hs-identifier">Application</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#Request"><span class="hs-identifier hs-type">Request</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Network.Wai.Internal.html#ResponseReceived"><span class="hs-identifier hs-type">ResponseReceived</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Network.Wai.Internal.html#ResponseReceived"><span class="hs-identifier hs-type">ResponseReceived</span></a><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span class="hs-comment">-- | A default, blank request.</span><span>
</span><a name="line-269"></a><span class="hs-comment">--</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- Since 2.0.0</span><span>
</span><a name="line-271"></a><span class="hs-identifier">defaultRequest</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.Wai.Internal.html#Request"><span class="hs-identifier hs-type">Request</span></a><span>
</span><a name="line-272"></a><a name="defaultRequest"><a href="Network.Wai.html#defaultRequest"><span class="hs-identifier">defaultRequest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#Request"><span class="hs-identifier hs-var">Request</span></a><span>
</span><a name="line-273"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">requestMethod</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">H.methodGet</span><span>
</span><a name="line-274"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">httpVersion</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">H.http10</span><span>
</span><a name="line-275"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rawPathInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B.empty</span><span>
</span><a name="line-276"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rawQueryString</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">B.empty</span><span>
</span><a name="line-277"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">requestHeaders</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-278"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isSecure</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-279"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">remoteHost</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">SockAddrInet</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-280"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pathInfo</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-281"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">queryString</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-282"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">requestBody</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">B.empty</span><span>
</span><a name="line-283"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vault</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-284"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">requestBodyLength</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.Internal.html#KnownLength"><span class="hs-identifier hs-var">KnownLength</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-285"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">requestHeaderHost</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-286"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">requestHeaderRange</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-287"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">requestHeaderReferer</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-288"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">requestHeaderUserAgent</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-289"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-comment">-- | Middleware is a component that sits between the server and application. It</span><span>
</span><a name="line-293"></a><span class="hs-comment">-- can do such tasks as GZIP encoding or response caching. What follows is the</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- general definition of middleware, though a middleware author should feel</span><span>
</span><a name="line-295"></a><span class="hs-comment">-- free to modify this.</span><span>
</span><a name="line-296"></a><span class="hs-comment">--</span><span>
</span><a name="line-297"></a><span class="hs-comment">-- As an example of an alternate type for middleware, suppose you write a</span><span>
</span><a name="line-298"></a><span class="hs-comment">-- function to load up session information. The session information is simply a</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- string map \[(String, String)\]. A logical type signature for this middleware</span><span>
</span><a name="line-300"></a><span class="hs-comment">-- might be:</span><span>
</span><a name="line-301"></a><span class="hs-comment">--</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- @ loadSession :: ([(String, String)] -&gt; Application) -&gt; Application @</span><span>
</span><a name="line-303"></a><span class="hs-comment">--</span><span>
</span><a name="line-304"></a><span class="hs-comment">-- Here, instead of taking a standard 'Application' as its first argument, the</span><span>
</span><a name="line-305"></a><span class="hs-comment">-- middleware takes a function which consumes the session information as well.</span><span>
</span><a name="line-306"></a><span class="hs-keyword">type</span><span> </span><a name="Middleware"><a href="Network.Wai.html#Middleware"><span class="hs-identifier">Middleware</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.Wai.html#Application"><span class="hs-identifier hs-type">Application</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.html#Application"><span class="hs-identifier hs-type">Application</span></a><span>
</span><a name="line-307"></a><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">-- | apply a function that modifies a response as a 'Middleware'</span><span>
</span><a name="line-310"></a><span class="hs-identifier">modifyResponse</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.Internal.html#Response"><span class="hs-identifier hs-type">Response</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.html#Middleware"><span class="hs-identifier hs-type">Middleware</span></a><span>
</span><a name="line-311"></a><a name="modifyResponse"><a href="Network.Wai.html#modifyResponse"><span class="hs-identifier">modifyResponse</span></a></a><span> </span><a name="local-6989586621679041158"><a href="#local-6989586621679041158"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679041159"><a href="#local-6989586621679041159"><span class="hs-identifier">app</span></a></a><span> </span><a name="local-6989586621679041160"><a href="#local-6989586621679041160"><span class="hs-identifier">req</span></a></a><span> </span><a name="local-6989586621679041161"><a href="#local-6989586621679041161"><span class="hs-identifier">respond</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041159"><span class="hs-identifier hs-var">app</span></a><span> </span><a href="#local-6989586621679041160"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679041161"><span class="hs-identifier hs-var">respond</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679041158"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span class="hs-comment">-- | conditionally apply a 'Middleware'</span><span>
</span><a name="line-315"></a><span class="hs-identifier">ifRequest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Network.Wai.Internal.html#Request"><span class="hs-identifier hs-type">Request</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.html#Middleware"><span class="hs-identifier hs-type">Middleware</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.Wai.html#Middleware"><span class="hs-identifier hs-type">Middleware</span></a><span>
</span><a name="line-316"></a><a name="ifRequest"><a href="Network.Wai.html#ifRequest"><span class="hs-identifier">ifRequest</span></a></a><span> </span><a name="local-6989586621679041162"><a href="#local-6989586621679041162"><span class="hs-identifier">rpred</span></a></a><span> </span><a name="local-6989586621679041163"><a href="#local-6989586621679041163"><span class="hs-identifier">middle</span></a></a><span> </span><a name="local-6989586621679041164"><a href="#local-6989586621679041164"><span class="hs-identifier">app</span></a></a><span> </span><a name="local-6989586621679041165"><a href="#local-6989586621679041165"><span class="hs-identifier">req</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679041162"><span class="hs-identifier hs-var">rpred</span></a><span> </span><a href="#local-6989586621679041165"><span class="hs-identifier hs-var">req</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041163"><span class="hs-identifier hs-var">middle</span></a><span> </span><a href="#local-6989586621679041164"><span class="hs-identifier hs-var">app</span></a><span> </span><a href="#local-6989586621679041165"><span class="hs-identifier hs-var">req</span></a><span>
</span><a name="line-317"></a><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>        </span><a href="#local-6989586621679041164"><span class="hs-identifier hs-var">app</span></a><span> </span><a href="#local-6989586621679041165"><span class="hs-identifier hs-var">req</span></a><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span>
</span><a name="line-321"></a><span class="hs-comment">-- | Get the request body as a lazy ByteString. However, do /not/ use any lazy</span><span>
</span><a name="line-322"></a><span class="hs-comment">-- I\/O, instead reading the entire body into memory strictly.</span><span>
</span><a name="line-323"></a><span class="hs-comment">--</span><span>
</span><a name="line-324"></a><span class="hs-comment">-- Since 3.0.1</span><span>
</span><a name="line-325"></a><span class="hs-identifier">strictRequestBody</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.Wai.Internal.html#Request"><span class="hs-identifier hs-type">Request</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span>
</span><a name="line-326"></a><a name="strictRequestBody"><a href="Network.Wai.html#strictRequestBody"><span class="hs-identifier">strictRequestBody</span></a></a><span> </span><a name="local-6989586621679041166"><a href="#local-6989586621679041166"><span class="hs-identifier">req</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-327"></a><span>    </span><a href="#local-6989586621679041167"><span class="hs-identifier hs-var">loop</span></a><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-328"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-329"></a><span>    </span><a name="local-6989586621679041167"><a href="#local-6989586621679041167"><span class="hs-identifier">loop</span></a></a><span> </span><a name="local-6989586621679041168"><a href="#local-6989586621679041168"><span class="hs-identifier">front</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-330"></a><span>        </span><a name="local-6989586621679041169"><a href="#local-6989586621679041169"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Network.Wai.Internal.html#getRequestBodyChunk"><span class="hs-identifier hs-var">getRequestBodyChunk</span></a><span> </span><a href="#local-6989586621679041166"><span class="hs-identifier hs-var">req</span></a><span>
</span><a name="line-331"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">B.null</span><span> </span><a href="#local-6989586621679041169"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-332"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679041168"><span class="hs-identifier hs-var">front</span></a><span> </span><span class="hs-identifier hs-var">LI.Empty</span><span>
</span><a name="line-333"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679041167"><span class="hs-identifier hs-var">loop</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041168"><span class="hs-identifier hs-var">front</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">LI.Chunk</span><span> </span><a href="#local-6989586621679041169"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-comment">-- | Get the request body as a lazy ByteString. This uses lazy I\/O under the</span><span>
</span><a name="line-336"></a><span class="hs-comment">-- surface, and therefore all typical warnings regarding lazy I/O apply.</span><span>
</span><a name="line-337"></a><span class="hs-comment">--</span><span>
</span><a name="line-338"></a><span class="hs-comment">-- Since 1.4.1</span><span>
</span><a name="line-339"></a><span class="hs-identifier">lazyRequestBody</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.Wai.Internal.html#Request"><span class="hs-identifier hs-type">Request</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span>
</span><a name="line-340"></a><a name="lazyRequestBody"><a href="Network.Wai.html#lazyRequestBody"><span class="hs-identifier">lazyRequestBody</span></a></a><span> </span><a name="local-6989586621679041170"><a href="#local-6989586621679041170"><span class="hs-identifier">req</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-341"></a><span>    </span><a href="#local-6989586621679041171"><span class="hs-identifier hs-var">loop</span></a><span>
</span><a name="line-342"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-343"></a><span>    </span><a name="local-6989586621679041171"><a href="#local-6989586621679041171"><span class="hs-identifier">loop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafeInterleaveIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-344"></a><span>        </span><a name="local-6989586621679041172"><a href="#local-6989586621679041172"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Network.Wai.Internal.html#getRequestBodyChunk"><span class="hs-identifier hs-var">getRequestBodyChunk</span></a><span> </span><a href="#local-6989586621679041170"><span class="hs-identifier hs-var">req</span></a><span>
</span><a name="line-345"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">B.null</span><span> </span><a href="#local-6989586621679041172"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-346"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">LI.Empty</span><span>
</span><a name="line-347"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-348"></a><span>                </span><a name="local-6989586621679041173"><a href="#local-6989586621679041173"><span class="hs-identifier">bss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679041171"><span class="hs-identifier hs-var">loop</span></a><span>
</span><a name="line-349"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">LI.Chunk</span><span> </span><a href="#local-6989586621679041172"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621679041173"><span class="hs-identifier hs-var">bss</span></a><span>
</span><a name="line-350"></a></pre></body></html>