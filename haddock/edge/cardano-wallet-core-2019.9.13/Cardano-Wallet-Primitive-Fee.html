<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Cardano.Wallet.Primitive.Fee</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Cardano.Wallet.Primitive.Fee.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-wallet-core-2019.9.13: The Wallet Backend for a Cardano node.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>&#169; 2018-2019 IOHK</td></tr><tr><th>License</th><td>Apache-2.0</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Cardano.Wallet.Primitive.Fee</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Types</a></li><li><a href="#g:2">Fee Calculation</a></li><li><a href="#g:3">Fee Adjustment</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Provides the API of Coin Selection algorithm and Fee Calculation
 This module contains the implementation of adjusting coin selection for a fee.
 The sender pays for the fee and additional inputs are picked randomly.
 For more information refer to:
 <a href="https://iohk.io/blog/self-organisation-in-coin-selection/">https://iohk.io/blog/self-organisation-in-coin-selection/</a></p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">newtype</span> <a href="#t:Fee">Fee</a> = <a href="#v:Fee">Fee</a> {<ul class="subs"><li><a href="#v:getFee">getFee</a> :: <a href="../base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:FeePolicy">FeePolicy</a> = <a href="#v:LinearFee">LinearFee</a> (<a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;lovelace&quot; <a href="../base-4.12.0.0/Prelude.html#t:Double" title="Prelude">Double</a>) (<a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;lovelace/x&quot; <a href="../base-4.12.0.0/Prelude.html#t:Double" title="Prelude">Double</a>)</li><li class="src short"><a href="#v:computeFee">computeFee</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:FeePolicy" title="Cardano.Wallet.Primitive.Fee">FeePolicy</a> -&gt; <a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;byte&quot; <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a></li><li class="src short"><a href="#v:divvyFee">divvyFee</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; [<a href="Cardano-Wallet-Primitive-Types.html#t:Coin" title="Cardano.Wallet.Primitive.Types">Coin</a>] -&gt; [(<a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a>, <a href="Cardano-Wallet-Primitive-Types.html#t:Coin" title="Cardano.Wallet.Primitive.Types">Coin</a>)]</li><li class="src short"><span class="keyword">data</span> <a href="#t:FeeOptions">FeeOptions</a> = <a href="#v:FeeOptions">FeeOptions</a> {<ul class="subs"><li><a href="#v:estimate">estimate</a> :: <a href="Cardano-Wallet-Primitive-CoinSelection.html#t:CoinSelection" title="Cardano.Wallet.Primitive.CoinSelection">CoinSelection</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a></li><li><a href="#v:dustThreshold">dustThreshold</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:Coin" title="Cardano.Wallet.Primitive.Types">Coin</a></li></ul>}</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:ErrAdjustForFee">ErrAdjustForFee</a> = <a href="#v:ErrCannotCoverFee">ErrCannotCoverFee</a> <a href="../base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></li><li class="src short"><a href="#v:adjustForFee">adjustForFee</a> :: MonadRandom m =&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:FeeOptions" title="Cardano.Wallet.Primitive.Fee">FeeOptions</a> -&gt; <a href="Cardano-Wallet-Primitive-Types.html#t:UTxO" title="Cardano.Wallet.Primitive.Types">UTxO</a> -&gt; <a href="Cardano-Wallet-Primitive-CoinSelection.html#t:CoinSelection" title="Cardano.Wallet.Primitive.CoinSelection">CoinSelection</a> -&gt; <a href="../mtl-2.2.2/Control-Monad-Except.html#t:ExceptT" title="Control.Monad.Except">ExceptT</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:ErrAdjustForFee" title="Cardano.Wallet.Primitive.Fee">ErrAdjustForFee</a> m <a href="Cardano-Wallet-Primitive-CoinSelection.html#t:CoinSelection" title="Cardano.Wallet.Primitive.CoinSelection">CoinSelection</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Types</h1></a><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:Fee" class="def">Fee</a> <a href="src/Cardano.Wallet.Primitive.Fee.html#Fee" class="link">Source</a> <a href="#t:Fee" class="selflink">#</a></p><div class="doc"><p>A <code><a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a></code>, isomorph to <code><a href="Cardano-Wallet-Primitive-Types.html#t:Coin" title="Cardano.Wallet.Primitive.Types">Coin</a></code> but ease type-signatures and readability.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Fee" class="def">Fee</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:getFee" class="def">getFee</a> :: <a href="../base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><details id="i:Fee" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Fee:Eq:1"></span> <a href="../base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a></span> <a href="src/Cardano.Wallet.Primitive.Fee.html#line-72" class="link">Source</a> <a href="#t:Fee" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Fee:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Primitive-Fee.html">Cardano.Wallet.Primitive.Fee</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Fee:Ord:2"></span> <a href="../base-4.12.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a></span> <a href="src/Cardano.Wallet.Primitive.Fee.html#line-72" class="link">Source</a> <a href="#t:Fee" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Fee:Ord:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Primitive-Fee.html">Cardano.Wallet.Primitive.Fee</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:compare">compare</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="../base-4.12.0.0/Data-Ord.html#t:Ordering" title="Data.Ord">Ordering</a> <a href="#v:compare" class="selflink">#</a></p><p class="src"><a href="#v:-60-">(&lt;)</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-60-" class="selflink">#</a></p><p class="src"><a href="#v:-60--61-">(&lt;=)</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-60--61-" class="selflink">#</a></p><p class="src"><a href="#v:-62-">(&gt;)</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-62-" class="selflink">#</a></p><p class="src"><a href="#v:-62--61-">(&gt;=)</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-62--61-" class="selflink">#</a></p><p class="src"><a href="#v:max">max</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> <a href="#v:max" class="selflink">#</a></p><p class="src"><a href="#v:min">min</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> <a href="#v:min" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:Fee:Show:3"></span> <a href="../base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a></span> <a href="src/Cardano.Wallet.Primitive.Fee.html#line-72" class="link">Source</a> <a href="#t:Fee" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:Fee:Show:3"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Primitive-Fee.html">Cardano.Wallet.Primitive.Fee</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; <a href="../base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a>] -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:FeePolicy" class="def">FeePolicy</a> <a href="src/Cardano.Wallet.Primitive.Fee.html#FeePolicy" class="link">Source</a> <a href="#t:FeePolicy" class="selflink">#</a></p><div class="doc"><p>A linear equation a free variable <code>x</code>. Represents the <code>s -&gt; a + b*s</code>
 function where <code>s</code> can be the transaction size in bytes or, a number of
 inputs + outputs.</p><p><code>a</code> and <code>b</code> are constant coefficients.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:LinearFee" class="def">LinearFee</a> (<a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;lovelace&quot; <a href="../base-4.12.0.0/Prelude.html#t:Double" title="Prelude">Double</a>) (<a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;lovelace/x&quot; <a href="../base-4.12.0.0/Prelude.html#t:Double" title="Prelude">Double</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><details id="i:FeePolicy" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FeePolicy:Eq:1"></span> <a href="../base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:FeePolicy" title="Cardano.Wallet.Primitive.Fee">FeePolicy</a></span> <a href="src/Cardano.Wallet.Primitive.Fee.html#line-81" class="link">Source</a> <a href="#t:FeePolicy" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FeePolicy:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Primitive-Fee.html">Cardano.Wallet.Primitive.Fee</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:FeePolicy" title="Cardano.Wallet.Primitive.Fee">FeePolicy</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:FeePolicy" title="Cardano.Wallet.Primitive.Fee">FeePolicy</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:FeePolicy" title="Cardano.Wallet.Primitive.Fee">FeePolicy</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:FeePolicy" title="Cardano.Wallet.Primitive.Fee">FeePolicy</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FeePolicy:Show:2"></span> <a href="../base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:FeePolicy" title="Cardano.Wallet.Primitive.Fee">FeePolicy</a></span> <a href="src/Cardano.Wallet.Primitive.Fee.html#line-81" class="link">Source</a> <a href="#t:FeePolicy" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FeePolicy:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Primitive-Fee.html">Cardano.Wallet.Primitive.Fee</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:FeePolicy" title="Cardano.Wallet.Primitive.Fee">FeePolicy</a> -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:FeePolicy" title="Cardano.Wallet.Primitive.Fee">FeePolicy</a> -&gt; <a href="../base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Cardano-Wallet-Primitive-Fee.html#t:FeePolicy" title="Cardano.Wallet.Primitive.Fee">FeePolicy</a>] -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><a href="#g:2" id="g:2"><h1>Fee Calculation</h1></a><div class="top"><p class="src"><a id="v:computeFee" class="def">computeFee</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:FeePolicy" title="Cardano.Wallet.Primitive.Fee">FeePolicy</a> -&gt; <a href="Data-Quantity.html#t:Quantity" title="Data.Quantity">Quantity</a> &quot;byte&quot; <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> <a href="src/Cardano.Wallet.Primitive.Fee.html#computeFee" class="link">Source</a> <a href="#v:computeFee" class="selflink">#</a></p><div class="doc"><p>Compute fee for a given payload. Fee follows a simple linear
 equation:</p><pre>    f = a + size * b
</pre><p>where <code>a</code> &amp; <code>b</code> are values fixed by the protocol.</p></div></div><div class="top"><p class="src"><a id="v:divvyFee" class="def">divvyFee</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a> -&gt; [<a href="Cardano-Wallet-Primitive-Types.html#t:Coin" title="Cardano.Wallet.Primitive.Types">Coin</a>] -&gt; [(<a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a>, <a href="Cardano-Wallet-Primitive-Types.html#t:Coin" title="Cardano.Wallet.Primitive.Types">Coin</a>)] <a href="src/Cardano.Wallet.Primitive.Fee.html#divvyFee" class="link">Source</a> <a href="#v:divvyFee" class="selflink">#</a></p><div class="doc"><p>Proportionally divide the fee over each output.</p><p>Pre-condition 1: The given outputs list shouldn't be empty
 Pre-condition 2: None of the outputs should be null</p><p>It returns the a list of pairs (fee, output).</p></div></div><a href="#g:3" id="g:3"><h1>Fee Adjustment</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:FeeOptions" class="def">FeeOptions</a> <a href="src/Cardano.Wallet.Primitive.Fee.html#FeeOptions" class="link">Source</a> <a href="#t:FeeOptions" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:FeeOptions" class="def">FeeOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:estimate" class="def">estimate</a> :: <a href="Cardano-Wallet-Primitive-CoinSelection.html#t:CoinSelection" title="Cardano.Wallet.Primitive.CoinSelection">CoinSelection</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a></dfn><div class="doc"><p>Estimate fees based on number of inputs and values of the outputs
 Some pointers / order of magnitude from the current configuration:
     a: 155381 # absolute minimal fees per transaction
     b: 43.946 # additional minimal fees per byte of transaction size</p></div></li><li><dfn class="src"><a id="v:dustThreshold" class="def">dustThreshold</a> :: <a href="Cardano-Wallet-Primitive-Types.html#t:Coin" title="Cardano.Wallet.Primitive.Types">Coin</a></dfn><div class="doc"><p>Change addresses below the given threshold will be evicted
 from the created transaction. Setting <code><a href="Cardano-Wallet-Primitive-Fee.html#v:dustThreshold" title="Cardano.Wallet.Primitive.Fee">dustThreshold</a></code> to 0
 removes output equal to 0</p></div></li></ul></div></td></tr></table></div><div class="subs instances"><details id="i:FeeOptions" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FeeOptions:Generic:1"></span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Generic" title="GHC.Generics">Generic</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:FeeOptions" title="Cardano.Wallet.Primitive.Fee">FeeOptions</a></span> <a href="src/Cardano.Wallet.Primitive.Fee.html#line-120" class="link">Source</a> <a href="#t:FeeOptions" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FeeOptions:Generic:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Primitive-Fee.html">Cardano.Wallet.Primitive.Fee</a></p> <div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:FeeOptions" title="Cardano.Wallet.Primitive.Fee">FeeOptions</a> :: <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> -&gt; <a href="../base-4.12.0.0/Data-Kind.html#t:Type" title="Data.Kind">Type</a> <a href="#t:Rep" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:from">from</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:FeeOptions" title="Cardano.Wallet.Primitive.Fee">FeeOptions</a> -&gt; <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:FeeOptions" title="Cardano.Wallet.Primitive.Fee">FeeOptions</a> x <a href="#v:from" class="selflink">#</a></p><p class="src"><a href="#v:to">to</a> :: <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:FeeOptions" title="Cardano.Wallet.Primitive.Fee">FeeOptions</a> x -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:FeeOptions" title="Cardano.Wallet.Primitive.Fee">FeeOptions</a> <a href="#v:to" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:FeeOptions:Rep:2"></span> <span class="keyword">type</span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:FeeOptions" title="Cardano.Wallet.Primitive.Fee">FeeOptions</a></span> <a href="src/Cardano.Wallet.Primitive.Fee.html#line-120" class="link">Source</a> <a href="#t:FeeOptions" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:FeeOptions:Rep:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Primitive-Fee.html">Cardano.Wallet.Primitive.Fee</a></p> <div class="src"><span class="keyword">type</span> <a href="../base-4.12.0.0/GHC-Generics.html#t:Rep" title="GHC.Generics">Rep</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:FeeOptions" title="Cardano.Wallet.Primitive.Fee">FeeOptions</a> = <a href="../base-4.12.0.0/GHC-Generics.html#t:D1" title="GHC.Generics">D1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaData" title="GHC.Generics">MetaData</a> &quot;FeeOptions&quot; &quot;Cardano.Wallet.Primitive.Fee&quot; &quot;cardano-wallet-core-2019.9.13-AdZFPETd9C583DNh9lrqLc&quot; <a href="../base-4.12.0.0/Data-Bool.html#v:False" title="Data.Bool">False</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:C1" title="GHC.Generics">C1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaCons" title="GHC.Generics">MetaCons</a> &quot;FeeOptions&quot; <a href="../base-4.12.0.0/GHC-Generics.html#v:PrefixI" title="GHC.Generics">PrefixI</a> <a href="../base-4.12.0.0/Data-Bool.html#v:True" title="Data.Bool">True</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> (<a href="../base-4.12.0.0/GHC-Maybe.html#v:Just" title="GHC.Maybe">Just</a> &quot;estimate&quot;) <a href="../base-4.12.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> <a href="../base-4.12.0.0/GHC-Generics.html#v:NoSourceStrictness" title="GHC.Generics">NoSourceStrictness</a> <a href="../base-4.12.0.0/GHC-Generics.html#v:DecidedLazy" title="GHC.Generics">DecidedLazy</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> (<a href="Cardano-Wallet-Primitive-CoinSelection.html#t:CoinSelection" title="Cardano.Wallet.Primitive.CoinSelection">CoinSelection</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:Fee" title="Cardano.Wallet.Primitive.Fee">Fee</a>)) <a href="../base-4.12.0.0/GHC-Generics.html#t::-42-:" title="GHC.Generics">:*:</a> <a href="../base-4.12.0.0/GHC-Generics.html#t:S1" title="GHC.Generics">S1</a> (<a href="../base-4.12.0.0/GHC-Generics.html#v:MetaSel" title="GHC.Generics">MetaSel</a> (<a href="../base-4.12.0.0/GHC-Maybe.html#v:Just" title="GHC.Maybe">Just</a> &quot;dustThreshold&quot;) <a href="../base-4.12.0.0/GHC-Generics.html#v:NoSourceUnpackedness" title="GHC.Generics">NoSourceUnpackedness</a> <a href="../base-4.12.0.0/GHC-Generics.html#v:NoSourceStrictness" title="GHC.Generics">NoSourceStrictness</a> <a href="../base-4.12.0.0/GHC-Generics.html#v:DecidedLazy" title="GHC.Generics">DecidedLazy</a>) (<a href="../base-4.12.0.0/GHC-Generics.html#t:Rec0" title="GHC.Generics">Rec0</a> <a href="Cardano-Wallet-Primitive-Types.html#t:Coin" title="Cardano.Wallet.Primitive.Types">Coin</a>)))</div></details></td></tr></table></details></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:ErrAdjustForFee" class="def">ErrAdjustForFee</a> <a href="src/Cardano.Wallet.Primitive.Fee.html#ErrAdjustForFee" class="link">Source</a> <a href="#t:ErrAdjustForFee" class="selflink">#</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ErrCannotCoverFee" class="def">ErrCannotCoverFee</a> <a href="../base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></td><td class="doc"><p>UTxO exhausted during fee covering
 We record what amount missed to cover the fee</p></td></tr></table></div><div class="subs instances"><details id="i:ErrAdjustForFee" open="open"><summary>Instances</summary><table><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ErrAdjustForFee:Eq:1"></span> <a href="../base-4.12.0.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:ErrAdjustForFee" title="Cardano.Wallet.Primitive.Fee">ErrAdjustForFee</a></span> <a href="src/Cardano.Wallet.Primitive.Fee.html#line-126" class="link">Source</a> <a href="#t:ErrAdjustForFee" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ErrAdjustForFee:Eq:1"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Primitive-Fee.html">Cardano.Wallet.Primitive.Fee</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-61--61-">(==)</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:ErrAdjustForFee" title="Cardano.Wallet.Primitive.Fee">ErrAdjustForFee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:ErrAdjustForFee" title="Cardano.Wallet.Primitive.Fee">ErrAdjustForFee</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-61--61-" class="selflink">#</a></p><p class="src"><a href="#v:-47--61-">(/=)</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:ErrAdjustForFee" title="Cardano.Wallet.Primitive.Fee">ErrAdjustForFee</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:ErrAdjustForFee" title="Cardano.Wallet.Primitive.Fee">ErrAdjustForFee</a> -&gt; <a href="../base-4.12.0.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a> <a href="#v:-47--61-" class="selflink">#</a></p></div></details></td></tr><tr><td class="src clearfix"><span class="inst-left"><span class="instance details-toggle-control details-toggle" data-details-id="i:id:ErrAdjustForFee:Show:2"></span> <a href="../base-4.12.0.0/Text-Show.html#t:Show" title="Text.Show">Show</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:ErrAdjustForFee" title="Cardano.Wallet.Primitive.Fee">ErrAdjustForFee</a></span> <a href="src/Cardano.Wallet.Primitive.Fee.html#line-126" class="link">Source</a> <a href="#t:ErrAdjustForFee" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><details id="i:id:ErrAdjustForFee:Show:2"><summary class="hide-when-js-enabled">Instance details</summary><p>Defined in <a href="Cardano-Wallet-Primitive-Fee.html">Cardano.Wallet.Primitive.Fee</a></p> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:ErrAdjustForFee" title="Cardano.Wallet.Primitive.Fee">ErrAdjustForFee</a> -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Cardano-Wallet-Primitive-Fee.html#t:ErrAdjustForFee" title="Cardano.Wallet.Primitive.Fee">ErrAdjustForFee</a> -&gt; <a href="../base-4.12.0.0/Data-String.html#t:String" title="Data.String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Cardano-Wallet-Primitive-Fee.html#t:ErrAdjustForFee" title="Cardano.Wallet.Primitive.Fee">ErrAdjustForFee</a>] -&gt; <a href="../base-4.12.0.0/Text-Show.html#t:ShowS" title="Text.Show">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></details></td></tr></table></details></div></div><div class="top"><p class="src"><a id="v:adjustForFee" class="def">adjustForFee</a> :: MonadRandom m =&gt; <a href="Cardano-Wallet-Primitive-Fee.html#t:FeeOptions" title="Cardano.Wallet.Primitive.Fee">FeeOptions</a> -&gt; <a href="Cardano-Wallet-Primitive-Types.html#t:UTxO" title="Cardano.Wallet.Primitive.Types">UTxO</a> -&gt; <a href="Cardano-Wallet-Primitive-CoinSelection.html#t:CoinSelection" title="Cardano.Wallet.Primitive.CoinSelection">CoinSelection</a> -&gt; <a href="../mtl-2.2.2/Control-Monad-Except.html#t:ExceptT" title="Control.Monad.Except">ExceptT</a> <a href="Cardano-Wallet-Primitive-Fee.html#t:ErrAdjustForFee" title="Cardano.Wallet.Primitive.Fee">ErrAdjustForFee</a> m <a href="Cardano-Wallet-Primitive-CoinSelection.html#t:CoinSelection" title="Cardano.Wallet.Primitive.CoinSelection">CoinSelection</a> <a href="src/Cardano.Wallet.Primitive.Fee.html#adjustForFee" class="link">Source</a> <a href="#v:adjustForFee" class="selflink">#</a></p><div class="doc"><p>Given the coin selection result from a policy run, adjust the outputs
 for fees, potentially returning additional inputs that we need to cover
 all fees.
 We lose the relationship between the transaction outputs and their
 corresponding inputs/change outputs here. This is a decision we
 may wish to revisit later. For now however note that since</p><p>(a) coin selection tries to establish a particular ratio
          between payment outputs and change outputs (currently it
          aims for an average of 1:1)</p><p>(b) coin selection currently only generates a single change
          output per payment output, distributing the fee
          proportionally across all change outputs is roughly
          equivalent to distributing it proportionally over the
          payment outputs (roughly, not exactly, because the 1:1
          proportion is best effort only, and may in some cases be
          wildly different).</p><p>Note that for (a) we don't need the ratio to be 1:1, the above
 reasoning will remain true for any proportion 1:n. For (b) however,
 if coin selection starts creating multiple outputs, and this number
 may vary, then losing the connection between outputs and change
 outputs will mean that that some outputs may pay a larger
 percentage of the fee (depending on how many change outputs the
 algorithm happened to choose).</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>