env:
  LC_ALL: "en_US.UTF-8"
  NIX_PATH: "channel:nixos-21.11"

  # Per-container variables
  SCRATCH_DIR: "/scratch/cardano-wallet"
  BUILD_DIR: "/build/cardano-wallet"
  CABAL_DIR: "/build/cardano-wallet.cabal"
  XDG_STATE_HOME: "/build/cardano-wallet/.state"
  XDG_CACHE_HOME: "/build/cardano-wallet/.cache"
  TESTS_LOGDIR: "/build/cardano-wallet/integration-test-logs"

  # Per-host variables - shared across containers on host
  CACHE_DIR: "/cache/cardano-wallet"

steps:
  - label: 'Check auto-generated Nix'
    key: nix
    commands:
      - './nix/regenerate.sh'
    agents:
      system: x86_64-linux

  - block: "Proceed with integration tests"
    prompt: "Clicking this button will proceed with integration tests"
    key: 'trigger_integration_tests'
    depends_on: nix
    # allow_dependency_failure: true
    # depends_on: [] # allows triggering this step even if previous steps failed

  - label: 'Run integration tests'
    depends_on: trigger_integration_tests
    command: 'nix build .#checks.cardano-wallet.integration'
    agents:
      system: x86_64-linux

