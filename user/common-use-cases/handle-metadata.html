<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Handle metadata - Cardano Wallet</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../.././mdbook-admonish.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Cardano Wallet</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="handle-metadata"><a class="header" href="#handle-metadata">Handle Metadata</a></h1>
<h2 id="pre-requisites"><a class="header" href="#pre-requisites">Pre-requisites</a></h2>
<ul>
<li><a href="start-wallet-server.html">how to start a server</a></li>
<li><a href="create-a-wallet.html">how to create a wallet</a></li>
<li>In order to be able to send transactions, our wallet must have funds. In case of <code>preview</code> and <code>preprod</code> <a href="https://testnets.cardano.org/en/testnets/cardano/overview/">testnets</a> we can request tADA from the <a href="https://testnets.cardano.org/en/testnets/cardano/tools/faucet/">faucet</a>.</li>
</ul>
<h2 id="transaction-metadata"><a class="header" href="#transaction-metadata">Transaction Metadata</a></h2>
<p>Since the Shelley era, the Cardano blockchain allows user-defined data to be associated with transactions.</p>
<p>The metadata hash is part of the transaction body, so is covered by all transaction signatures.</p>
<p>The cardano-wallet API server uses a JSON representation of transaction metadata, isomorphic to the binary encoding on chain.</p>
<div id="admonition-warning" class="admonition admonish-warning" role="note" aria-labelledby="admonition-warning-title">
<div class="admonition-title">
<div id="admonition-warning-title">
<p>Warning</p>
</div>
<a class="admonition-anchor-link" href="#admonition-warning"></a>
</div>
<div>
<p>Please note that metadata provided in a transaction will be stored on the blockchain forever. Make sure not to include any sensitive data, in particular personally identifiable information (PII).</p>
</div>
</div>
<h2 id="metadata-structure-on-chain"><a class="header" href="#metadata-structure-on-chain">Metadata structure on chain</a></h2>
<p>The <strong>top level</strong> is a map from metadata keys to metadata values.</p>
<p><strong>Metadata keys</strong> are integers in the range 0 to 2<sup>64</sup> - 1.</p>
<p><strong>Metadata values</strong> are one of three simple types or two compound types.</p>
<p>Simple types:</p>
<ul>
<li>
<p><em>Integers</em> in the range -(2<sup>64</sup> - 1) to 2<sup>64</sup> - 1</p>
</li>
<li>
<p><em>Strings</em> (UTF-8 encoded)</p>
</li>
<li>
<p><em>Bytestrings</em></p>
</li>
</ul>
<p>Compound types:</p>
<ul>
<li>
<p>Lists of <em>metadata values</em></p>
</li>
<li>
<p>Mappings from <em>metadata values</em> to <em>metadata values</em></p>
</li>
</ul>
<p>Note that lists and maps need not necessarily contain the same type of metadata value in each element.</p>
<h3 id="limits"><a class="header" href="#limits">Limits</a></h3>
<ul>
<li>Strings may be at most 64 bytes long when UTF-8 encoded.</li>
<li>Unencoded bytestrings may be at most 64 bytes long (i.e. at most 128 hex digits).</li>
<li>There are no limits to the number of metadata values, apart from the protocol limit on transaction size.</li>
</ul>
<p>The string length limitation is explained in the
<a href="https://hydra.iohk.io/job/Cardano/cardano-ledger-specs/delegationDesignSpec/latest/download-by-type/doc-pdf/delegation_design_spec">Delegation Design Spec, section E.3</a>:</p>
<blockquote>
<p>The size of strings in the structured value is limited to mitigate
the problem of unpleasant or illegal content being posted to the
blockchain. It does not prevent this problem entirely, but it means
that it is not as simple as posting large binary blobs.</p>
</blockquote>
<h2 id="json-representation-in-cardano-wallet"><a class="header" href="#json-representation-in-cardano-wallet">JSON representation in cardano-wallet</a></h2>
<p>The <strong>top level</strong> is a JSON object mapping <strong>metadata keys</strong> as
decimal number strings to JSON objects for metadata values.</p>
<p>Every <strong>metadata value</strong> is tagged with its type, using a JSON object,
like this:</p>
<ul>
<li>
<p><em>Integers</em></p>
<p><code>{ "int": NUMBER }</code></p>
</li>
<li>
<p><em>Strings</em></p>
<p><code>{ "string": STRING }</code></p>
</li>
<li>
<p><em>Bytestrings</em></p>
<p><code>{ "bytes": HEX-STRING }</code></p>
<p>The value must be base16-encoded (a hex string).</p>
</li>
<li>
<p>Lists of <em>metadata values</em></p>
<p><code>{ "list": [ METADATA-VALUE, ... ] }</code></p>
</li>
<li>
<p>Mappings from <em>metadata values</em> to <em>metadata values</em></p>
<p><code>{ "map": [{ "k": METADATA-VALUE, "v": METADATA-VALUE }, ... ] }</code></p>
</li>
</ul>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<p>This is a transaction metadata which contains four values.</p>
<pre><code class="language-json">{
  "64": {"string": "some text"},
  "32": {"int": 42},
  "16": {
    "map": [
      {
        "k": {"string": "numbers"},
        "v": {"list": [{"int": 1}, {"int": 2}, {"int": 4}, {"int": 8}]}
      },
      {
        "k": {"string": "alphabet"},
        "v": {
          "map": [
            {"k": {"string": "A"}, "v": {"int": 65}},
            {"k": {"string": "B"}, "v": {"int": 66}},
            {"k": {"string": "C"}, "v": {"int": 67}}
          ]
        }
      }
    ]
  },
  "8": { "bytes": "48656c6c6f2c2043617264616e6f21" }
}
</code></pre>
<h2 id="sample-code-converting-from-javascript-objects"><a class="header" href="#sample-code-converting-from-javascript-objects">Sample code: Converting from JavaScript objects</a></h2>
<p>Use a function like this to translate arbitrary JavaScript values into metadata JSON format. If your application requires a more precise mapping, it can be modified to suit. Note that this code does not validate strings for length.</p>
<pre><code class="language-javascript">#!/usr/bin/env node

function txMetadataValueFromJS(jsVal) {
  if (Array.isArray(jsVal)) {
    // compound type - List
    // (note that sparse arrays are not representable in JSON)
    return { list: jsVal.map(txMetadataValueFromJS) };
  } else if (typeof(jsVal) === 'object') {
    if (jsVal !== null ) {
      // compound type - Map with String keys
      return { map: Object.keys(jsVal).map(key =&gt; {
        return { k: { string: key }, v: txMetadataValueFromJS(jsVal[key]) };
      }) };
    } else {
      // null: convert to simple type - String
      return { string: 'null' };
    }
  } else if (Number.isInteger(jsVal)) {
    // simple type - Int
    return { int: jsVal };
  } else if (typeof(jsVal) === 'string') {
    // simple type - String
    return { string: jsVal };
  } else {
    // anything else: convert to simple type - String.
    // e.g. undefined, true, false, NaN, Infinity.
    // Some of these can't be represented in JSON anyway.
    // Floating point numbers: note there can be loss of precision when
    // representing floats as decimal numbers
    return { string: '' + jsVal };
  }
}

// Get JSON objects from stdin, one per line.
const jsVals = require('fs')
  .readFileSync(0, { encoding: 'utf8' })
  .toString()
  .split(/\r?\n/)
  .filter(line =&gt; !!line)
  .map(JSON.parse);

// Convert to transaction metadata JSON form
const txMetadataValues = jsVals.map(txMetadataValueFromJS);
const txMetadata = txMetadataValues
  .reduce((ob, val, i) =&gt; { ob['' + i] = val; return ob; }, {});

// Print JSON to stdout
console.log(JSON.stringify(txMetadata));
</code></pre>
<h2 id="cli"><a class="header" href="#cli">CLI</a></h2>
<p>Metadata can be provided when creating transactions through the
<a href="../cli.html">cli</a>.</p>
<p>The JSON is provided directly as a command-line argument.</p>
<ul>
<li>On Linux/MacOS JSON metadata can be put inside single quotes:</li>
</ul>
<pre><code>--metadata '{ "0":{ "string":"cardano" } }'
</code></pre>
<ul>
<li>On Windows it can be put in double quotes with double quotes inside JSON metadata escaped:</li>
</ul>
<pre><code>--metadata "{ \"0\":{ \"string\":\"cardano\" } }"
</code></pre>
<pre><code>Usage: cardano-wallet transaction create [--port INT] WALLET_ID
                                         --payment PAYMENT [--metadata JSON]
  Create and submit a new transaction.

Available options:
  -h,--help                Show this help text
  --port INT               port used for serving the wallet API. (default: 8090)
  --payment PAYMENT        address to send to and amount to send separated by @,
                           e.g. '&lt;amount&gt;@&lt;address&gt;'
  --metadata JSON          Application-specific transaction metadata as a JSON
                           object. The value must match the schema defined in
                           the cardano-wallet OpenAPI specification.
</code></pre>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<p>For a detailed explanation of the metadata design, and information about the transaction format, consult the following specifications.</p>
<ol>
<li><a href="https://hydra.iohk.io/job/Cardano/cardano-ledger-specs/delegationDesignSpec/latest/download-by-type/doc-pdf/delegation_design_spec">Delegation Design Spec</a>, Appendix E.</li>
<li><a href="https://hydra.iohk.io/job/Cardano/cardano-ledger-specs/specs.shelley-ledger/latest/download-by-type/doc-pdf/ledger-spec">Cardano Shelley Ledger Spec</a>, Figure 10.</li>
</ol>
<p>The full JSON schema is specified in the OpenAPI 3.0 <code>swagger.yaml</code>.</p>
<ol>
<li><a href="https://cardano-foundation.github.io/cardano-wallet/api/edge/#operation/postTransaction">cardano-wallet OpenAPI Documentation</a>, Shelley / Transactions / Create.</li>
<li><a href="https://github.com/cardano-foundation/cardano-wallet/blob/master/specifications/api/swagger.yaml">cardano-wallet OpenAPI Specification</a>, scroll to <code>TransactionMetadataValue</code>.</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../user/common-use-cases/delegation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../user/common-use-cases/shared-wallets.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../user/common-use-cases/delegation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../user/common-use-cases/shared-wallets.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>


    </div>
    </body>
</html>
