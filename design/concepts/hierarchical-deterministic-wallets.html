<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Hierarchical Deterministic Wallets - Cardano Wallet</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../.././mdbook-admonish.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Cardano Wallet</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="hierarchical-deterministic-hd-wallets"><a class="header" href="#hierarchical-deterministic-hd-wallets">Hierarchical Deterministic (HD) Wallets</a></h1>
<p>In Cardano, <em>hierarchical deterministic</em> (HD) wallets are similar to those described in
<a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#motivation">BIP-0032</a>.</p>
<p>Deterministic wallets and elliptic curve mathematics permit schemes
where one can calculate a wallet public keys without revealing its
private keys. This permits for example a webshop business to let its
webserver generate fresh addresses (public key hashes) for each order
or for each customer, without giving the webserver access to the
corresponding private keys (which are required for spending the
received funds).  However, deterministic wallets typically consist of
a single "chain" of keypairs. The fact that there is only one chain
means that sharing a wallet happens on an all-or-nothing basis.</p>
<p>However, in some cases one only wants some (public) keys to be shared
and recoverable. In the example of a webshop, the webserver does not
need access to all public keys of the merchant's wallet; only to those
addresses which are used to receive customer's payments, and not for
example the change addresses that are generated when the merchant
spends money. Hierarchical deterministic wallets allow such selective
sharing by supporting multiple keypair chains, derived from a single
root.</p>
<h2 id="notation"><a class="header" href="#notation">Notation</a></h2>
<p>Conceptually, HD derivation can be seen as a tree with many branches,
where keys live at each node and leaf such that an entire sub-tree can
be recovered from only a parent key (and seemingly, the whole tree can
be recovered from the root master key).</p>
<p><a href="Ed25519_BIP.pdf">BIP32-Ed25519: Hierarchical Deterministic Keys over a Non-linear Keyspace</a>.
For deriving new keys from parent keys, we use the same approach as defined in</p>
<p>We note \(CKD_{priv}\) the derivation of a private child key from a parent private key such that:</p>
<p>$$
CKD_{prv}((k^P, c^P), i) → (k_i, c_i)
$$</p>
<p>We note \(CKD_{pub}\) the derivation of a public child key from a parent public key such that:</p>
<p>$$
i &lt;  2^{31}: CKD_{pub}((A^P, c^P), i) → (A_i, c_i)
$$</p>
<h3 id="note"><a class="header" href="#note">Note</a></h3>
<p>This is only possible for so-called "soft" derivation indexes, smaller than \(2^{31}\).</p>
<p>We note \(N\) the public key corresponding to a private key such that:</p>
<p>$$ N(k, c) → (A, c) $$</p>
<p>To shorten notation, we will borrow the same notation as described in BIP-0032
and write</p>
<p>\(CKD_{priv}(CKD_{priv}(CKD_{priv}(m,3H),2),5)\) as <code>m/3H/2/5</code>.</p>
<p>Equivalently for public keys, we write</p>
<p>\(CKD_{pub}(CKD_{pub}(CKD_{pub}(M,3),2),5)\) as <code>M/3/2/5</code>.</p>
<h3 id="path-levels"><a class="header" href="#path-levels">Path Levels</a></h3>
<p>Cardano wallet defines the following path levels:</p>
<p>$$
m / purpose_H / coin_type_H / account_H / account\_type / address\_index
$$</p>
<ul>
<li>\(purpose_H = 1852_H\)</li>
<li>\(coin\_type_H = 1815_H\)</li>
<li>\(account_H = 0_H\)</li>
<li>\(account\_type \) is either:
<ul>
<li><code>0</code> to indicate an address on the external chain, that is, an address
that is meant to be public and communicated to other users.</li>
<li><code>1</code> to indicate an address on the internal chain, that is, an address
that is meant for change, generated by a wallet software.</li>
<li><code>2</code> to indicate a reward account address, used for delegation.</li>
</ul>
</li>
<li>\(address\_index\) is either:
<ul>
<li><code>0</code> if the \(account\_type\) is <code>2</code></li>
<li>Anything between \(0\) and \(2^{31}\) otherwise</li>
</ul>
</li>
</ul>
<p>In the <em>Byron</em> era, sequential wallets used in Yoroi (a.k.a Icarus wallets) have been using $$purpose = 44_H$$ according to standard BIP-44 wallets.
The <em>Shelley</em> era introduces however an extension to BIP-44, and therefore, uses a different $purpose$ number.</p>
<h3 id="account-discovery"><a class="header" href="#account-discovery">Account Discovery</a></h3>
<p>What follows is taken from the "Account Discovery" section from <a href="https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki#account-discovery">BIP-0044</a></p>
<p>When the master seed is imported from an external source the software should start to discover the accounts in the following manner:</p>
<ul>
<li>derive the first account's node (index = 0)</li>
<li>derive the external chain node of this account</li>
<li>scan addresses of the external chain; respect the gap limit described below</li>
<li>if no transactions are found on the external chain, stop discovery</li>
<li>if there are some transactions, increase the account index and go to step 1</li>
</ul>
<p>For the algorithm to be successful, software should disallow creation of new accounts if previous one has no transaction history.</p>
<p>Please note that the algorithm works with the transaction history, not account balances, so you can have an account with 0 total coins and the algorithm will still continue with discovery.</p>
<h3 id="address-gap-limit"><a class="header" href="#address-gap-limit">Address gap limit</a></h3>
<p>Address gap limit is currently set to 20. If the software hits 20 unused addresses in a row, it expects there are no used addresses beyond this point and stops searching the address chain. We scan just the external chains, because internal chains receive only coins that come from the associated external chains.</p>
<p>Wallet software should warn when the user is trying to exceed the gap limit on an external chain by generating a new address.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../design/concepts/coin-selection.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../design/concepts/transaction-lifecycle.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../design/concepts/coin-selection.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../design/concepts/transaction-lifecycle.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../mermaid.min.js"></script>
        <script src="../../mermaid-init.js"></script>



    </div>
    </body>
</html>
